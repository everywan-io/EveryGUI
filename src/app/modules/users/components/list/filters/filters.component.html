<div id="actions" class="row mb-3" *showItBootstrap="['xs', 'sm']">
    <div class="col-6 pl-0 py-2 text-left" (click)="filters.visible = !filters.visible">
        <span class="action">{{ 'users.list.actions.filter' | translate }}</span>
    </div>
</div>

<form class="w-100">
    <div id="filters" class="row form-group align-items-center mt-0" [hidden]="!filters.visible">
        <div id="search" class="col-12 col-md-6 col-xl-2 d-flex flex-column px-0 mb-2 mb-xl-0">
            <ng-container *ngTemplateOutlet="search; context:{ key: 'term', hint: 'users.list.filters.fields.term.placeholder' | translate }"></ng-container>
        </div>

        <div id="gender" class="col-12 col-md-6 col-xl-2 d-flex flex-column px-0 mb-2 mb-xl-0 pl-md-3">
            <ng-container *ngTemplateOutlet="gender; context:{ key: 'gender', hint: 'users.list.filters.fields.gender.placeholder' | translate, options: filterOptionsDescriptors.gender }"></ng-container>
        </div>

        <div id="fromDate" class="col-6 col-md-6 col-xl-2 d-flex flex-column px-0 mb-2 mb-xl-0 pl-xl-3">
            <ng-container *ngTemplateOutlet="daterange;
            context:{
                key: 'from_date_dob',
                hint: 'users.list.filters.fields.dateRange.fromDate' | translate,
                ngModel: queryFromDate,
                options: {
                    minDate: {year: 1919, month: 1, day: 1}
                }
            }"></ng-container>
        </div>

        <div id="toDate" class="col-6 col-md-6 col-xl-2 d-flex flex-column pr-0 pl-2 pl-md-3 mb-2 mb-xl-0">
            <ng-container *ngTemplateOutlet="daterange;
            context:{
                key: 'to_date_dob',
                hint: 'users.list.filters.fields.dateRange.toDate' | translate,
                ngModel: queryToDate,
                options: {
                    minDate: {year: 1919, month: 1, day: 1},
                    placement: 'bottom-right'
                }
            }"></ng-container>
        </div>

        <div id="status" class="col-12 col-md-6 col-xl-2 d-flex flex-column px-0 mb-2 mb-xl-0 pl-xl-3">
            <ng-container *ngTemplateOutlet="status; context:{ key: 'account', hint: 'users.list.filters.fields.account.placeholder' | translate, options: filterOptionsDescriptors.status }"></ng-container>
        </div>

        <div id="groups" class="col-12 col-md-6 col-xl-2 d-flex flex-column px-0 mb-2 pl-md-3 md-3 mb-xl-0">
            <ng-container *ngTemplateOutlet="groups;
            context:{
                key: 'group',
                ngModel: queryGroup,
                hint: 'users.list.filters.fields.groups.placeholder' | translate
            }"></ng-container>
        </div>

    </div>
</form>

<ng-template #search let-filterKey="key" let-hintText="hint">
    <div class="search input-group">
        <input type="text"
               class="form-control"
               [ngModel]="queryTerm"
               [placeholder]="hintText"
               (keyup)="filters.subject.next({ key: filterKey, value: $event.target['value'] })">

        <div class="input-group-append">
            <i class="mdi mdi-magnify" *ngIf="!loading.term"></i>
            <i class="mdi mdi-loading" *ngIf="loading.term"></i>
        </div>
    </div>
</ng-template>

<ng-template #gender let-filterKey="key" let-hintText="hint" let-selected="default" let-options="options">
    <select class="option form-control"
            [ngModel]="queryGender"
            (change)="filters.subject.next({ key: filterKey, value: $event.target['value'] })">
        <option value="" selected>{{ hintText }}</option>
        <option *ngFor="let option of options" [value]="option.value">{{ option.title }}</option>
    </select>
</ng-template>

<ng-template #status let-filterKey="key" let-hintText="hint" let-selected="default" let-options="options">
    <select class="option form-control"
            [ngModel]="queryAccount"
            (change)="filters.subject.next({ key: filterKey, value: $event.target['value'] })">
        <option value="" selected>{{ hintText }}</option>
        <option *ngFor="let option of options" [value]="option.value">{{ option.title }}</option>
    </select>
</ng-template>

<ng-template #daterange let-filterKey="key" let-hintText="hint" let-options="options" let-ngModel="ngModel">
    <div class="date-picker input-group">
        <input type="text"
               class="form-control"
               ngbDatepicker
               #datePicker="ngbDatepicker"
               [ngModel]="ngModel"
               [placeholder]="hintText"
               [showWeekdays]="options['showWeekdays']"
               [showWeekNumbers]="options['showWeekNumbers']"
               [placement]="options['placement'] || 'bottom-left'"
               [minDate]="options['minDate']"
               [maxDate]="options['maxDate']"
               (click)="datePicker.toggle()"
               (dateSelect)="filters.subject.next({ key: filterKey, value: $event })"
               (keyup)="onDateInputFieldKeyPressed(filterKey, $event.target['value'])">

        <div class="input-group-append" (click)="datePicker.toggle()">
            <i class="mdi mdi-calendar-range"></i>
        </div>
    </div>
</ng-template>

<ng-template #groups let-filterKey="key" let-hintText="hint" let-ngModel="ngModel">
    <div class="input-group">
        <input id="typeaheadGroups" type="text" class="form-control"
               [placeholder]="hintText"
               [ngModel]="ngModel"
               [ngbTypeahead]="searchGroup"
               [inputFormatter]="groupFormatter"
               [resultTemplate]="rt"
               (selectItem)="filters.subject.next({ key: filterKey, value: $event.item.id })"/>

        <div class="input-group-append">
            <i class="mdi mdi-magnify" *ngIf="!loading.term"></i>
            <i class="mdi mdi-loading" *ngIf="loading.term"></i>
        </div>
    </div>

    <ng-template #rt let-r="result" let-t="term">
        <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
    </ng-template>

</ng-template>
